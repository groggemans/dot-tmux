##############################################################################
#
# @file tmux.conf
# @date May, 2015
# @author G. Roggemans <g.roggemans@grog.be>
# @copyright Copyright (c) GROG [https://grog.be] 2015, All Rights Reserved
#
#   This script is free software: you can redistribute it and/or modify it
#   under the terms of the GNU Lesser General Public License as published by
#   the Free Software Foundation, either version 3 of the License, or (at your
#   option) any later version.
#
#   This script is distributed in the hope that it will be useful, but
#   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
#   or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public
#   License for more details.
#
#   You should have received a copy of the GNU Lesser General Public License
#   along with this script. If not, see <http://www.gnu.org/licenses/>.
#
##############################################################################

# Do not use default bindings
unbind -a


##############################################################################
# Disable mouse support

setw -g mode-mouse off
set -g mouse-select-pane off
set -g mouse-resize-pane off
set -g mouse-select-window off


##############################################################################
# General settings

# Use UTF8
set -g utf8
set -g status-utf8 on
set-window-option -g utf8 on

# Use 256 colors
set -g default-terminal "screen-256color"

# Start numbering from 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber after closing window
set -g renumber-windows on

# Enable focus events
set -g focus-events on

# Address vim mode switching delay
set -s escape-time 0

# Set scrollback history
set -g history-limit 10000

# Border colors
set -g pane-border-fg colour236
set -g pane-border-bg colour233
set -g pane-active-border-fg colour25
set -g pane-active-border-bg colour233


##############################################################################
# Status bar settings

# Enable status bar
set -g status on

# Update every 5 seconds
set -g status-interval 5

# Show messages for 3 seconds
set -g display-time 3000

# Show activity
setw -g monitor-activity on

# Prevent activity message
set -g visual-activity off

# Colors
set -g status-fg colour240
set -g status-bg colour233

# Message/command
set -g message-fg colour195
set -g message-bg colour236

# Window tab
set -g status-justify centre
setw -g window-status-fg colour145
setw -g window-status-bg colour236
setw -g window-status-format " #I: #W "

# Current window tab
setw -g window-status-current-fg colour195
setw -g window-status-current-bg colour25
setw -g window-status-current-format " #I: #W "

# Window tab with activity
setw -g window-status-activity-fg colour166
setw -g window-status-activity-bg colour232

# Left section
set -g status-left-length 90
setw -g status-left "#[fg=colour195]#[bg=colour25] #h ^#{uptime} \
#[fg=colour145]#[bg=colour236] #S "

# Right section
set -g status-right-length 90
setw -g status-right "#[fg=colour145]#[bg=colour236] \
#{avg} #{mem} \
#{online_status}#[fg=colour195]#[bg=colour25] %a %h-%d %H:%M "


##############################################################################
# Key bindings

# Change prefix key
set -g prefix C-a
bind C-a send-prefix

# Fast reloading of tmux.conf
bind r source ~/.tmux.conf

# Bind command prompt (also `Alt`+ `;` for faster commands)
bind : command-prompt
bind -n M-\; command-prompt

# List keys
bind ? list-keys


##############################################################################
# Dynamic key bindings

# Load Function key bindings
source ~/.tmux/f-keys.tmux

# Option to load byobu function key bindings
bind b source ~/.tmux/byobu.f-keys.tmux

# Option to load default key bindings
bind d source ~/.tmux/default.tmux

##############################################################################
# Window/Pane manipulation

# Vertical and horizontal split
bind s split-window -v
bind v split-window -h

# Vim style pane resizing
bind H resize-pane -L 5
bind J resize-pane -D 5
bind K resize-pane -U 5
bind L resize-pane -R 5


##############################################################################
# Navigation

# Vim style navigation in copy mode
setw -g mode-keys vi

# Smart pane switching with awareness of vim splits
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?)(diff)?$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"


##############################################################################
# Plugins

set -g @tpm_plugins '               \
  tmux-plugins/tpm                  \
  tmux-plugins/tmux-resurrect       \
  tmux-plugins/tmux-online-status   \
  tmux-plugins/tmux-battery         \
  knakayama/tmux-mem                \
  knakayama/tmux-uptime             \
  knakayama/tmux-avg                \
'


##############################################################################
# Plugins settings

# tmux-online-status
#
    set -g @online_icon "#[fg=colour10]|-\-\-|"
    set -g @offline_icon "#[fg=colour9]|-/-|"


##############################################################################
# Local config

if-shell "[ -f ~/.tmux.conf.local ]" 'source ~/.tmux.conf.local'


##############################################################################
# Plugin manager

# Install plugin manager if not installed
if-shell "[ ! -f ~/.tmux/plugins/tpm/README.md ]" 'source ~/.tmux/tpm-install.tmux'

# Run plugin manager
run-shell '~/.tmux/plugins/tpm/tpm'


##############################################################################
